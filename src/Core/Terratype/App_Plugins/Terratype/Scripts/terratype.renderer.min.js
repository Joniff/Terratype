(function(n){n.terratype||(n.terratype={_poll:100,_killSwitch:1200,providers:{},_addProvider:function(t,i){n.terratype.providers[t]=n.terratype.providers[t]?n.terratype._mergeJson(n.terratype.providers[t],i):i;n.terratype.providers[t]._status=0;n.terratype.providers[t]._domDetectionType=99},coordinateSystems:{},_addCoordinateSystem:function(t,i){n.terratype.coordinateSystems[t]=n.terratype.coordinateSystems[t]?n.terratype._mergeJson(n.terratype.coordinateSystems[t],i):i},_events:[[],[],[],[],[],[]],_addEvent:function(t,i){n.terratype._events[t].push(i)},_callEvent:function(t,i,r,u){n.terratype._forEach(n.terratype._events[t],function(n,t){(function(n,t,i,r){n(t,i,r)})(t,i,r,u)})},onInit:function(t){n.terratype._addEvent(0,t)},_callInit:function(t){n.terratype._callEvent(0,t)},onLoad:function(t){n.terratype._events[1].push(t)},_callLoad:function(t,i){n.terratype._callEvent(1,t,i)},onRender:function(t){n.terratype._events[2].push(t)},_callRender:function(t,i){n.terratype._callEvent(2,t,i)},onRefresh:function(t){n.terratype._events[3].push(t)},_callRefresh:function(t,i){n.terratype._callEvent(3,t,i)},onClick:function(t){n.terratype._events[4].push(t)},_callClick:function(t,i,r){n.terratype._callEvent(4,t,i,r)},onZoom:function(t){n.terratype._events[5].push(t)},_callZoom:function(t,i,r){n.terratype._callEvent(5,t,i,r)},_forEach:function(n,t){for(var i=0;i!=n.length;i++)(function(n,t,i){n(t,i)})(t,i,n[i])},_mergeJson:function(n,t){var i=function(n){var r={};for(var t in n)r[t]=n[t]&&typeof n[t]=="object"&&n[t].constructor.name!=="Array"?i(n[t]):n[t];return r},r=function(n,t){var f=n?i(n):{},u;if(t)for(u in t)f[u]=f[u]&&typeof f[u]=="object"&&f[u].constructor.name!=="Array"?r(f[u],t[u]):t[u];return f};return r(n,t)},_configIconUrl:function(t){return typeof t=="undefined"||t==null?"":t.indexOf("//")!=-1?t:(t.substring(0,1)!="/"&&(t="/"+t),n.location.protocol+"//"+n.location.hostname+(n.location.port?":"+n.location.port:"")+t)},_getAnchorHorizontal:function(n,t){if(typeof n=="string")switch(n.charAt(0)){case"l":case"L":return 0;case"c":case"C":case"m":case"M":return t/2;case"r":case"R":return t-1}return Number(n)},_getAnchorVertical:function(n,t){if(typeof n=="string")switch(n.charAt(0)){case"t":case"T":return 0;case"c":case"C":case"m":case"M":return t/2;case"b":case"B":return t-1}return Number(n)},_parseLatLng:function(n){var r=n.trim().split(","),t,i;return r.length<2?!1:(t=parseFloat(r[0].substring(0,10)),isNaN(t)||t>90||t<-90)?!1:(i=parseFloat(r[1].substring(0,10)),isNaN(i)||i>180||i<-180)?!1:{latitude:t,longitude:i}},_isElementInViewport:function(n){var t=n.getBoundingClientRect();return t.top<=(window.innerHeight||document.documentElement.clientHeight)&&t.top+t.height>=0&&t.left<=(window.innerWidth||document.documentElement.clientWidth)&&t.left+t.width>=0},_opacityShow:function(n){var t=document.getElementById(n._div);t.style.opacity="1.0";t.style.filter="alpha(opacity=100)"},_idleJs:function(t,i){var r=document.getElementById(i._div),o=r.parentElement.offsetTop+r.parentElement.offsetWidth,u=r.clientHeight*r.clientWidth,f=!(r.style.display&&typeof r.style.display=="string"&&r.style.display.toLowerCase()=="none"),e=f&&n.terratype._isElementInViewport(r);o!=0&&f==!1?r.style.display="block":o==0&&f==!0?(r.style.display="none",i.visible=!1):e==!0&&i._divoldsize!=0&&u!=0&&i._divoldsize!=u?(function(n,i){t.refresh.call(n,i)}(t,i),i.visible=!0):e==!0&&i.visible==!1?(function(n,i){t.refresh.call(n,i)}(t,i),i.visible=!0):e==!1&&i.visible==!0&&(i.visible=!1);i._divoldsize=u},_idleJquery:function(n,t){var i=jQuery(document.getElementById(t.div)),r=!i.is(":hidden"),f=i.is(":visible"),u;if(r==f){r&&(u=i.height()*i.width(),u!=t._divoldsize&&function(t,i){n.refresh.call(t,i)}(n,t),t._divoldsize=u);return}if(r){i.hide();t._divoldsize=0,function(t,i){n.refresh.call(t,i)}(n,t);return}i.show(),function(t,i){n.refresh.call(t,i)}(n,t);t._divoldsize=i.height()*i.width()},_loadCss:function(n){for(var t,i=0;i!=n.length;i++)document.createStyleSheet?document.createStyleSheet(n[i]):(t=document.createElement("link"),t.rel="stylesheet",t.type="text/css",t.href=n[i],t.media="screen",document.getElementsByTagName("head")[0].appendChild(t))},_getMap:function(n,t){for(var i=0;i!=n.length;i++)if(n[i].id==t)return n[i];return null},_jQueryMonitoring:!1,_jQueryMonitorTimer:null,_jQueryMonitor:function(){var t=0,i=0,r=[];for(var u in n.terratype.providers)r.push(u.id);n.terratype._jQueryMonitorTimer!=null&&n.clearInterval(n.terratype._jQueryMonitorTimer);n.terratype._jQueryMonitorTimer=n.setInterval(function(){if(t==r.length)n.clearInterval(n.terratype._jQueryMonitorTimer);else{var u=n.terratype.providers[r[t]];i==u.maps.length?(t++,i=0):n.terratype._idleJquery(u,u.maps[i++])}},n.terratype._poll)},_initTimer:null,init:function(){var o=0,i=null,u=0,t=0,f=0,r=0,e;if(n.terratype._initTimer!=null){n.clearInterval(n.terratype._initTimer);for(e in n.terratype.providers)e._status=0,e.maps=[]}n.terratype._initTimer=n.setInterval(function(){var e,s,h,c;if(o++,i==null){i=[];for(e in n.terratype.providers)i.push(e);t=0;u=0;f=0;r=0}else if(u==i.length)i=null,t==0&&o>n.terratype._killSwitch&&n.clearInterval(n.terratype._initTimer);else if(e=n.terratype.providers[i[u]],e._status==3&&f<e.maps.length){s=e.maps[f++];switch(s._status){case 0:(function(n,t){e._render.call(n,t)})(e,s);s._status=1;t++;r++;break;case 1:if(n.jQuery&&e._domDetectionType==1){if(n.terratype._jQueryMonitoring==!1){n.jQuery(window).on("DOMContentLoaded load resize scroll touchend",n.terratype._jQueryMonitor);n.terratype._jQueryMonitoring=!0}}else e._domDetectionType!=2&&(t++,n.terratype._idleJs(e,s));r++}}else{switch(e._status){case 0:t++;e.ready()&&(e._status=1,n.terratype._callInit(e));break;case 1:t++;h=document.getElementsByClassName(e.id);h.length==0?e._status=-1:(n.terratype._forEach(h,function(t,i){var o=parseInt(i.getAttribute("data-dom-detection-type")),u,r,f;e._domDetectionType>o&&(e._domDetectionType=o);mapId=i.getAttribute("data-map-id");id=i.getAttribute("data-id");u=JSON.parse(unescape(i.getAttribute("data-model")));r=n.terratype._getMap(e.maps,mapId);r==null&&(i.style.display="block",f={},e._loadMap&&function(n,t,i){f=e._loadMap.call(n,t,i)}(e,u,i),r=n.terratype._mergeJson(f,{zoom:u.zoom,_ignoreEvents:0,_refreshes:0,id:mapId,_div:id,_divoldsize:0,_status:0,visible:!1,autoFit:i.getAttribute("data-auto-fit")?!0:!1,recenterAfterRefresh:i.getAttribute("data-recenter-after-refresh")?!0:!1,handle:null,positions:[],getPosition:function(n){for(var t=0;t!=r._positions.length;t++)if(r._positions[t].tag==n)return r._positions[t];return null},isVisible:function(){var t=document.getElementById(r._div),i=t.parentElement.offsetTop+t.parentElement.offsetWidth,u=t.clientHeight*t.clientWidth,f=!(t.style.display&&typeof t.style.display=="string"&&t.style.display.toLowerCase()=="none"),e=f&&n.terratype._isElementInViewport(document.getElementById(r._div));return e&&i>0&&u>0},refresh:function(){(function(n,t){e.refresh.call(n,t)})(e,r)}}),e.maps.push(r));e._loadMarker&&function(n,t,i,r){e._loadMarker.call(n,t,i,r)}(e,r,u,i)}),n.terratype._forEach(e.maps,function(t,i){n.terratype._callLoad(e,i)}),e._status=2);break;case 2:t++;c=!0;e._prerender&&function(n){c=e._prerender.call(n)}(e);c&&(e._status=3);break;case 3:t++;r==0&&(e._status=-1)}u++;f=0;r=0}},n.terratype._poll)}},n.terratype.init())})(window);