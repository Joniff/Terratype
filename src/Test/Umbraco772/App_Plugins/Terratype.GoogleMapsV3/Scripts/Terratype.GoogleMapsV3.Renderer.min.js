(function(n){var i=!1,t={id:"Terratype.GoogleMapsV3",maps:[],_defaultProvider:{predefineStyling:"retro",showRoads:!0,showLandmarks:!0,showLabels:!0,variety:{basic:!0,satellite:!1,terrain:!1,selector:{type:1,position:0}},streetView:{enable:!1,position:0},fullscreen:{enable:!1,position:0},scale:{enable:!1,position:0},zoomControl:{enable:!0,position:0},panControl:{enable:!1},draggable:!0},ready:function(){return i},_loadMap:function(i){return{_provider:n.terratype._mergeJson(t._defaultProvider,i.provider),_center:null,_bound:new n.google.maps.LatLngBounds(null)}},_loadMarker:function(t,i,r){if(i.position){var f=n.terratype._parseLatLng(i.position.datum),u=new n.google.maps.LatLng(f.latitude,f.longitude);t._center==null&&(t._center=u);i.icon&&i.icon.url&&(t.positions.push({id:id,tag:r.getAttribute("data-tag"),label:r.getAttribute("data-label-id"),position:i.position,_latlng:u,_icon:{url:n.terratype._configIconUrl(i.icon.url),scaledSize:new n.google.maps.Size(i.icon.size.width,i.icon.size.height),anchor:new n.google.maps.Point(n.terratype._getAnchorHorizontal(i.icon.anchor.horizontal,i.icon.size.width),n.terratype._getAnchorVertical(i.icon.anchor.vertical,i.icon.size.height))},autoShowLabel:r.getAttribute("data-auto-show-label")?!0:!1}),t._bound.extend(u))}},_markerClustererUrl:function(){return document.getElementsByClassName(t.id)[0].getAttribute("data-markerclusterer-url")},_mapTypeIds:function(n,t,i){var r=[];return n&&r.push("roadmap"),t&&r.push("satellite"),i&&r.push("terrain"),r.length==0&&r.push("roadmap"),r},_render:function(i){var r=t._mapTypeIds(i._provider.variety.basic,i._provider.variety.satellite,i._provider.variety.terrain),u;i.autoFit&&(i._center=i._bound.getCenter());i.handle=new n.google.maps.Map(document.getElementById(i._div),{disableDefaultUI:!1,scrollwheel:!1,panControl:!1,center:i._center,zoom:i.zoom,draggable:!0,fullScreenControl:i._provider.fullscreen.enable,fullscreenControlOptions:i._provider.fullscreen.position,styles:i._provider.styles,mapTypeId:r[0],mapTypeControl:r.length>1,mapTypeControlOptions:{style:i._provider.variety.selector.type,mapTypeIds:r,position:i._provider.variety.selector.position},scaleControl:i._provider.scale.enable,scaleControlOptions:{position:i._provider.scale.position},streetViewControl:i._provider.streetView.enable,streetViewControlOptions:{position:i._provider.streetView.position},zoomControl:i._provider.zoomControl.enable,zoomControlOptions:{position:i._provider.zoomControl.position}});n.google.maps.event.addListener(i.handle,"zoom_changed",function(){i._ignoreEvents>0||(t.closeInfoWindows(i),i.zoom=i.handle.getZoom(),n.terratype._callZoom(t,i,i.zoom))});n.google.maps.event.addListenerOnce(i.handle,"tilesloaded",function(){var r=document.getElementById(i._div);n.terratype._isElementInViewport(r)&&r.clientHeight!=0&&r.clientWidth!=0&&t.refresh(i)});n.google.maps.event.addListener(i.handle,"resize",function(){i._ignoreEvents>0||t._checkResize(i)});n.google.maps.event.addListener(i.handle,"click",function(){i._ignoreEvents>0||t.closeInfoWindows(i)});u=[];n.terratype._forEach(i.positions,function(r,f){f.handle=new n.google.maps.Marker({map:i.handle,position:f._latlng,id:f.id,draggable:!1,icon:f._icon});f._info=null;var e=f.label?document.getElementById(f.label):null;e?(f._info=new n.google.maps.InfoWindow({content:e}),f.handle.addListener("click",function(){i._ignoreEvents>0||(t.closeInfoWindows(i),f._info!=null&&t.openInfoWindow(i,r))}),n.terratype._domDetectionType==2&&f.autoShowLabel&&n.setTimeout(function(){t.openInfoWindow(i,i.positions[r])},100)):f.handle.addListener("click",function(){n.terratype._callClick(t,i,f)});u.push(f.handle)});i.positions.length>1&&(i._markerclusterer=new MarkerClusterer(i.handle,u,{imagePath:t._markerClustererUrl()}))},openInfoWindow:function(i,r){var u=i.positions[r];u._info.open(i.handle,u.handle);n.terratype._callClick(t,i,u)},closeInfoWindows:function(t){n.terratype._forEach(t.positions,function(n,t){t._info!=null&&t._info.close()})},_checkResize:function(n){n.handle.getBounds().contains(n._center)||t.refresh(n)},_resetCenter:function(t){if(t.autoFit){t.handle.setZoom(20);var i=new n.google.maps.LatLngBounds(t._bound.getSouthWest(),t._bound.getNorthEast());t.handle.fitBounds(i)}t.zoom=t.handle.getZoom();t.handle.setCenter(t._center)},_checkResetCenter:function(i){i._refreshes==0&&(n.terratype._forEach(i.positions,function(r,u){u.autoShowLabel&&n.setTimeout(function(){t.openInfoWindow(i,r)},100)}),i._status=2);(i._refreshes==0||i.recenterAfterRefresh)&&t._resetCenter(i);i._refreshes++==0?(n.terratype._opacityShow(i),n.terratype._callRender(t,i)):n.terratype._callRefresh(t,i)},refresh:function(i){i._ignoreEvents==0&&(i._ignoreEvents++,n.google.maps.event.addListenerOnce(i.handle,"tilesloaded",function(){i._idle!=null&&(i._ignoreEvents--,i._ignoreEvents==0&&t._checkResetCenter(i),i._idle&&n.clearTimeout(i._idle))}),i._idle=n.setTimeout(function(){i._ignoreEvents!=0&&(t._checkResetCenter(i),i._ignoreEvents=0);n.clearTimeout(i._idle);i._idle=null},5e3),n.google.maps.event.trigger(i.handle,"resize"))}},r;n.terratype&&n.terratype._addProvider?n.terratype._addProvider(t.id,t):r=n.setInterval(function(){n.terratype&&n.terratype._addProvider&&(n.terratype._addProvider(t.id,t),n.clearInterval(r))},100);n.TerratypeGoogleMapsV3CallbackRender=function(){i=!0}})(window);