(function(n){Number.isInteger=Number.isInteger||function(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n};var t="Terratype";n.terratype||(n.terratype={loading:!1,providers:{},event:{events:[],register:function(t,i,r,u,f){n.terratype.event.events.push({id:t,name:i,func:f,scope:r,object:u})},cancel:function(t){var i=[];angular.forEach(n.terratype.event.events,function(n){n.id!=t&&i.push(n)});n.terratype.event.events=i},broadcast:function(t){angular.forEach(n.terratype.event.events,function(n){n.name==t&&n.func.call(n.scope,n.object)})},broadcastSingle:function(t,i){for(var u=0,r;u!=2&&n.terratype.event.events.length!=0;)if(i>=n.terratype.event.events.length&&(i=0,u++),r=n.terratype.event.events[i++],r.name==t)return r.func.call(r.scope,r.object),i;return null},present:function(t){if(t){var i=0;return angular.forEach(n.terratype.event.events,function(n){n.id!=t&&i++}),i}return n.terratype.event.events.length}},absoluteUrl:function(t){return t?t.indexOf("//")!=-1?t:(t.substring(0,1)!="/"&&(t="/"+t),n.location.protocol+"//"+n.location.hostname+(n.location.port?":"+n.location.port:"")+t):""},iconCustom:function(n,t){if(!n.anchor.horizontal.isManual)switch(n.anchor.horizontal.automatic){case"left":n.anchor.horizontal.manual=0;break;case"center":n.anchor.horizontal.manual=(t.size.width-1)/2|0;break;case"right":n.anchor.horizontal.manual=t.size.width-1}if(!n.anchor.vertical.isManual)switch(n.anchor.vertical.automatic){case"top":n.anchor.vertical.manual=0;break;case"center":n.anchor.vertical.manual=(t.size.height-1)/2|0;break;case"bottom":n.anchor.vertical.manual=t.size.height-1}},predefine:[{id:"",name:"[Custom]",url:"",shadowUrl:"",size:{width:32,height:32},anchor:{horizontal:"center",vertical:"bottom"}},{id:"redmarker",name:"Red Marker",url:"https://mt.google.com/vt/icon/name=icons/spotlight/spotlight-poi.png",shadowUrl:"",size:{width:22,height:40},anchor:{horizontal:"center",vertical:"bottom"}},{id:"greenmarker",name:"Green Marker",url:"https://mt.google.com/vt/icon?psize=30&font=fonts/arialuni_t.ttf&color=ff304C13&name=icons/spotlight/spotlight-waypoint-a.png&ax=43&ay=48&text=%E2%80%A2",shadowUrl:"",size:{width:22,height:43},anchor:{horizontal:"center",vertical:"bottom"}},{id:"bluemarker",name:"Blue Marker",url:"https://mt.google.com/vt/icon/name=icons/spotlight/spotlight-waypoint-blue.png",shadowUrl:"",size:{width:22,height:40},anchor:{horizontal:"center",vertical:"bottom"}},{id:"purplemarker",name:"Purple Marker",url:"https://mt.google.com/vt/icon/name=icons/spotlight/spotlight-ad.png",shadowUrl:"",size:{width:22,height:40},anchor:{horizontal:"center",vertical:"bottom"}},{id:"goldstar",name:"Gold Star",url:"https://mt.google.com/vt/icon/name=icons/spotlight/star_L_8x.png&scale=2",shadowUrl:"",size:{width:42,height:42},anchor:{horizontal:"center",vertical:"center"}},{id:"greyhome",name:"Grey Home",url:"https://mt.google.com/vt/icon/name=icons/spotlight/home_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"redshoppingcart",name:"Red Shopping Cart",url:"https://mt.google.com/vt/icon/name=icons/spotlight/supermarket_search_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"blueshoppingcart",name:"Blue Shopping Cart",url:"https://mt.google.com/vt/icon/name=icons/spotlight/supermarket_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"redhotspring",name:"Red Hot Spring",url:"https://mt.google.com/vt/icon/name=icons/spotlight/jp/hot_spring_search_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"reddharma",name:"Red Dharma",url:"https://mt.google.com/vt/icon/name=icons/spotlight/worship_dharma_search_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"browndharma",name:"Brown Dharma",url:"https://mt.google.com/vt/icon/name=icons/spotlight/worship_dharma_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"redjain",name:"Red Jain",url:"https://mt.google.com/vt/icon/name=icons/spotlight/worship_jain_search_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"brownjain",name:"Brown Jain",url:"https://mt.google.com/vt/icon/name=icons/spotlight/worship_jain_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"redshopping",name:"Red Shopping",url:"https://mt.google.com/vt/icon/name=icons/spotlight/shopping_search_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"blueshopping",name:"Blue Shopping",url:"https://mt.google.com/vt/icon/name=icons/spotlight/shopping_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"redharbour",name:"Red Harbour",url:"https://mt.google.com/vt/icon/name=icons/spotlight/harbour_search_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"blueharbour",name:"Blue Harbour",url:"https://mt.google.com/vt/icon/name=icons/spotlight/harbour_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"orangeumbraco",name:"Orange Umbraco",url:Umbraco.Sys.ServerVariables.umbracoSettings.umbracoPath+"/assets/img/application/logo.png",shadowUrl:"",size:{width:32,height:32},anchor:{horizontal:"center",vertical:"center"}},{id:"blackumbraco",name:"Black Umbraco",url:Umbraco.Sys.ServerVariables.umbracoSettings.umbracoPath+"/assets/img/application/logo_black.png",shadowUrl:"",size:{width:32,height:32},anchor:{horizontal:"center",vertical:"center"}},{id:"whiteumbraco",name:"White Umbraco",url:Umbraco.Sys.ServerVariables.umbracoSettings.umbracoPath+"/assets/img/application/logo_white.png",shadowUrl:"",size:{width:32,height:32},anchor:{horizontal:"center",vertical:"center"}},{id:"redcircle",name:"Red Circle",url:"https://mt.google.com/vt/icon/name=icons/spotlight/generic_search_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"orangecircle",name:"Orange Circle",url:"https://mt.google.com/vt/icon/name=icons/spotlight/ad_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"browncircle",name:"Brown Circle",url:"https://mt.google.com/vt/icon/name=icons/spotlight/generic_establishment_v_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"greencircle",name:"Green Circle",url:"https://mt.google.com/vt/icon/name=icons/spotlight/generic_recreation_v_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},{id:"bluecircle",name:"Blue Circle",url:"https://mt.google.com/vt/icon/name=icons/spotlight/generic_retail_v_L_8x.png&scale=2",shadowUrl:"",size:{width:48,height:48},anchor:{horizontal:"center",vertical:"center"}},]});angular.module("umbraco.directives").directive("terratypeJson",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){function e(n){if(n&&n.trim()!==""){try{u=angular.fromJson(n);r.$setValidity("invalidJson",!0)}catch(t){r.$setValidity("invalidJson",!1)}return u}return{}}function f(n){return angular.toJson(n,!0)}var u;r.$parsers.push(e);r.$formatters.push(f);t.bind("blur",function(){t.val(f(n.$eval(i.ngModel)))});n.$watch(i.ngModel,function(n,t){u=u||n;n!=t&&(r.$setViewValue(f(n)),r.$render())},!0)}}});angular.module("umbraco.directives").directive("terratypeTranslate",["$compile","localizationService",function(n,t){return function(i,r,u){u.$observe("terratypeTranslate",function(u){t.localize(u).then(function(t){var u=n("<span>"+t+"<\/span>")(i);r.append(u)})})}}]);angular.module("umbraco.directives").directive("terratypeIgnoreEnterKey",["$rootScope",function(){return function(n,t){t.on("keydown keypress",function(n){n.which===13&&n.preventDefault()})}}]);angular.module("umbraco").controller("terratype",["$scope","$timeout","$http","localizationService",function($scope,i,$http,r){$scope.config=null;$scope.store=null;$scope.vm=null;$scope.identifier=$scope.$id+(new Date).getTime();$scope.viewmodel={showMap:!1,config:{label:{enable:!1,editPosition:0}},configs:[],position:{},providers:[],provider:{id:null,referenceUrl:null,name:null},label:{},labels:[],loading:!0,configgering:!1,error:null,isPreview:!1,icon:{anchor:{horizontal:{},vertical:{}}},providerTestResults:[]};$scope.terratype={urlProvider:function(n,t,i){var r=Umbraco.Sys.ServerVariables.umbracoSettings.appPluginsPath+"/"+n+"/"+t;return i==!0&&(r+="?cache=1.0.20"),r},images:{loading:Umbraco.Sys.ServerVariables.umbracoSettings.appPluginsPath+"/Terratype/Images/loader.gif",failed:Umbraco.Sys.ServerVariables.umbracoSettings.appPluginsPath+"/Terratype/Images/false.png",success:Umbraco.Sys.ServerVariables.umbracoSettings.appPluginsPath+"/Terratype/Images/true.png"},controller:function(n){return Umbraco.Sys.ServerVariables.umbracoSettings.umbracoPath+"/backoffice/"+t+"/ajax/"+n},poll:250,mapId:function(n,t){for(var i=0;i!=n.length;i++)if(n[i].id==t)return i;return-1},translate:function(n){r.localize(n.name).then(function(t){n.name=t});r.localize(n.description).then(function(t){n.description=t});n.referenceUrl&&r.localize(n.referenceUrl).then(function(t){n.referenceUrl=t})},initLabels:function(n){$http.get($scope.terratype.controller("labels")).then(function(t){angular.forEach(t.data,function(n){$scope.terratype.translate(n);$scope.terratype.setLabelView(n)});i(function(){$scope.vm().labels=t.data;n()})})},setLabelView:function(n){n.view||(n.view=$scope.terratype.urlProvider(t,"views/label."+n.id+".html",!0));n.controller||(n.controller="terratype.label."+n.id)},initConfig:function(){$scope.vm=function(){return $scope.viewmodel};$scope.vm().configgering=!0;$scope.terratype.initLabels(function(){typeof $scope.model.value=="string"&&($scope.model.value=$scope.model.value!=""?JSON.parse($scope.model.value):{});$scope.config=function(){return $scope.model.value.config};$scope.store=function(){return $scope.model.value};$scope.terratype.setIcon();$http.get($scope.terratype.controller("providers")).then(function(n){angular.forEach(n.data,function(n){$scope.terratype.translate(n);angular.forEach(n.coordinateSystems,function(n){$scope.terratype.translate(n)})});i(function(){$scope.vm().providers=n.data;$scope.config&&$scope.config().provider&&$scope.config().provider.id!=null&&$scope.terratype.setProvider($scope.config().provider.id);i(function(){$scope.vm().loading=!1})})},function(){$scope.vm().loading=!1})})},loadProvider:function(t,r){var u=setInterval(function(){if(!n.terratype.loading)if(clearInterval(u),angular.isUndefined(n.terratype.providers[t])){n.terratype.loading=!0;var f=$scope.terratype.urlProvider(t,"scripts/"+t+".js",!0);LazyLoad.js(f,function(){i(function(){if(angular.isUndefined(n.terratype.providers[t]))throw f+" does not define global variable root.terratype.providers['"+t+"']";n.terratype.providers[t].script=f;r(t);n.terratype.loading=!1})})}else r()},$scope.terratype.poll)},setIcon:function(){$scope.config().icon&&$scope.config().icon.id&&$scope.terratype.iconPredefineChangeInternal($scope.config().icon.id);$scope.terratype.iconAnchor();$scope.config().icon&&!$scope.config().icon.id&&$scope.terratype.iconCustom()},loadResources:function(n,t,i){var u,r;if(t.css&&t.css.length!=0)for(r=0;r!=t.css.length;r++)LazyLoad.css($scope.terratype.urlProvider(n,t.css[r],!0));if(t.js&&t.js.length!=0){for(u=[],r=0;r!=t.js.length;r++)u.push($scope.terratype.urlProvider(n,t.js[r],!0));LazyLoad.js(u,i)}else i()},setProvider:function(t){var u=$scope.terratype.mapId($scope.vm().providers,t);u!=-1&&($scope.config().provider?t!=$scope.config().provider.id?($scope.vm().provider&&$scope.vm().provider.events&&$scope.vm().provider.events.destroy&&$scope.vm().provider.events.destroy(),$scope.vm().configs[$scope.config().provider.id]=angular.copy($scope.config().provider),$scope.config().provider=$scope.vm().configs[t]||{}):$scope.config().provider.id=t:$scope.config().provider={id:t,grid:{enable:!1}},$scope.vm().providerLoading=!0,i(function(){$scope.terratype.loadProvider(t,function(){$scope.vm().providers[u]=angular.extend($scope.vm().providers[u],n.terratype.providers[t]);$scope.terratype.loadResources(t,$scope.vm().providers[u],function(){$scope.vm().providers[u].boot($scope.identifier,$scope.terratype.urlProvider,$scope.store,$scope.config,$scope.vm,function(){$scope.$apply()},function(n,t){r.localize(n).then(function(n){t(n)})},function(n){$scope.vm().providers[u].events=n;$scope.vm().provider=angular.copy($scope.vm().providers[u]);$scope.vm().provider.events.setProvider();$scope.store().position&&$scope.store().position.id!=null&&$scope.terratype.setCoordinateSystem($scope.store().position.id);i(function(){if($scope.vm().configgering)for(var n in $scope.vm().provider.events.httpCalls)with({hc:$scope.vm().provider.events.httpCalls[n]})$http.get($scope.terratype.controller("DataTypeFields?when="+hc.when+"&field="+hc.field)).then(function(n){hc.values=n.data});$scope.vm().providerLoading=!1})})})})}))},setCoordinateSystem:function(n){var t=$scope.terratype.mapId($scope.vm().provider.coordinateSystems,n);$scope.vm().position=t!=-1?angular.copy($scope.vm().provider.coordinateSystems[t]):{id:null,referenceUrl:null,name:null,datum:null,precision:6};$scope.vm().configgering&&($scope.store().position.precision=$scope.vm().position.precision);$scope.vm().provider.events.setCoordinateSystem()},setLabel:function(n){if(n){var t=$scope.terratype.mapId($scope.vm().labels,n);t==-1&&(t=0);$scope.vm().label=$scope.vm().labels[t]}angular.extend($scope.store().label,$scope.vm().label);$scope.vm().provider.events.labelChange()},iconAnchor:function(){isNaN($scope.config().icon.anchor.horizontal)?($scope.vm().icon.anchor.horizontal.isManual=!1,$scope.vm().icon.anchor.horizontal.automatic=$scope.config().icon.anchor.horizontal):($scope.vm().icon.anchor.horizontal.isManual=!0,$scope.vm().icon.anchor.horizontal.manual=$scope.config().icon.anchor.horizontal);isNaN($scope.config().icon.anchor.vertical)?($scope.vm().icon.anchor.vertical.isManual=!1,$scope.vm().icon.anchor.vertical.automatic=$scope.config().icon.anchor.vertical):($scope.vm().icon.anchor.vertical.isManual=!0,$scope.vm().icon.anchor.vertical.manual=$scope.config().icon.anchor.vertical)},iconPredefineChangeInternal:function(t){var r=0,i;t&&(r=$scope.terratype.mapId(n.terratype.predefine,t),t==-1&&(r=0));$scope.config().icon.id=t;i=n.terratype.predefine[r];$scope.config().icon.url=i.url;$scope.config().icon.size=i.size;$scope.config().icon.anchor=i.anchor;$scope.terratype.iconAnchor()},iconPredefineChange:function(n){$scope.terratype.iconPredefineChangeInternal(n);$scope.vm().provider.events.setIcon()},absoluteUrl:function(t){return n.terratype.absoluteUrl(t)},iconCustom:function(){$scope.config().icon.id=n.terratype.predefine[0].id;n.terratype.iconCustom($scope.vm().icon,$scope.config().icon)},iconImageChange:function(){$scope.vm().icon.urlFailed="";$http({url:$scope.terratype.controller("image"),method:"GET",params:{url:$scope.config().icon.url}}).then(function(n){n.data.status==200?($scope.config().icon.size={width:n.data.width,height:n.data.height},$scope.config().icon.format=n.data.format):$scope.vm().icon.urlFailed=n.data.error},function(n){$scope.vm().icon.urlFailed=n.data});$scope.terratype.iconCustom()},icon:{anchor:{horizontal:{},vertical:{}},predefine:n.terratype.predefine},loadEditor:function(n,t,i){$scope.store().zoom||($scope.store().zoom=t.zoom);$scope.store().position&&$scope.store().position.id&&$scope.store().position.datum?$scope.store().position.id!=t.position.id?$http({url:$scope.terratype.controller("convertcoordinatesystem"),method:"GET",params:{sourceId:$scope.store().position.id,sourceDatum:$scope.store().position.datum,destinationId:t.position.id}}).then(function(r){$scope.store().position.datum=r.data;$scope.store().position.id=t.position.id;$scope.terratype.loadEditor2(n,t,i)}):$scope.terratype.loadEditor2(n,t,i):($scope.store().position={id:t.position.id,datum:t.position.datum},$scope.terratype.loadEditor2(n,t,i))},loadEditor2:function(i,u,f){$scope.terratype.loadProvider($scope.config().provider.id,function(){$scope.vm().isPreview=!angular.isUndefined($scope.model.sortOrder);$scope.vm().provider=angular.copy(n.terratype.providers[$scope.config().provider.id]);var e=angular.copy($scope.store().position);e.precision=u.position.precision;$scope.vm().provider.coordinateSystems=[];$scope.vm().provider.coordinateSystems.push(e);$scope.vm().position=angular.copy(e);$scope.vm().label=$scope.config().label;$scope.terratype.setLabelView($scope.vm().label);$scope.vm().loading=!1;setTimeout(function(){$scope.terratype.loadResources($scope.config().provider.id,$scope.vm().provider,function(){$scope.vm().provider.boot(i,$scope.terratype.urlProvider,$scope.store,$scope.config,$scope.vm,function(){$scope.$apply()},function(n,t){r.localize(n).then(function(n){t(n)})},function(n){if($scope.vm().provider.events=n,$scope.terratype.labelOverlay.view=$scope.terratype.urlProvider(t,"views/label."+$scope.config().label.id+".html",!0),$scope.config().label.enable==!0&&$scope.config().label.editPosition==0)with({display:$scope.terratype.labelOverlay.display})$scope.vm().provider.events.addEvent("icon-click",function(){display()},$scope);$scope.vm().showMap=!0;f&&f()})})},150)})},isCsv:function(n){for(var t,r=0,u=0,i=0,f=n.length;i!=f;i++)if(t=n.charAt(i),t==",")r++;else if(t==".")u++;else if(t<"0"||t>"9")return!1;return r==2&&u<=2},convertCsv:function(n){var t=n.split(","),i=parseInt(t[2]);return{zoom:i,position:{id:"WGS84",datum:t[0]+","+t[1]}}},initEditor:function(){$scope.vm=function(){return $scope.viewmodel};$scope.vm().error=!1;try{typeof $scope.model.value=="string"&&($scope.model.value=$scope.terratype.isCsv($scope.model.value)?convertCsv($scope.model.value):$scope.model.value!=""?JSON.parse($scope.model.value):null);$scope.model.value||($scope.model.value={})}catch(n){$scope.vm().error=!0;$scope.model.value={}}try{$scope.terratype.labelOverlay.init();$scope.config=function(){return $scope.model.config.definition.config};$scope.store=function(){return $scope.model.value};$scope.terratype.loadEditor($scope.identifier,$scope.model.config.definition)}catch(n){console.log(n);$scope.vm().loading=!1;$scope.vm().error=!0;$scope.config().debug=1}},gridOverlay:{identifier:null,title:"terratypeGridOverlay_title",subtitle:"terratypeGridOverlay_subtitle",show:!1,display:function(){$scope.terratype.gridOverlay.show!=!0&&($scope.vm=function(){return $scope.terratype.gridOverlay.vm},$scope.config=function(){return $scope.terratype.gridOverlay.vm.config},$scope.control.value&&($scope.terratype.gridOverlay.store=angular.copy($scope.control.value)),$scope.store=function(){return $scope.terratype.gridOverlay.store},$scope.terratype.setLabelView($scope.config().label),$scope.terratype.gridOverlay.dataTypes.length==0?$http.get($scope.terratype.controller("maps")).then(function(n){$scope.terratype.gridOverlay.dataTypes=n.data;$scope.terratype.gridOverlay.displayLoad()}):$scope.terratype.gridOverlay.displayLoad())},displayLoad:function(){$scope.terratype.gridOverlay.show=!0;$scope.store().datatypeId&&$scope.terratype.gridOverlay.setDatatype($scope.store().datatypeId)},submit:function(){$scope.control.value=angular.copy($scope.terratype.gridOverlay.store);$scope.terratype.gridOverlay.close()},close:function(){$scope.viewmodel.loading=!0;$scope.terratype.gridOverlay.show=!1;$scope.vm().provider.events&&$scope.vm().provider.events.destroy();i(function(){$scope.terratype.loadGrid()},$scope.terratype.poll)},view:"uninitalized",dataTypes:[],vm:{showMap:!1,config:{label:{enable:!1,editPosition:0}},position:[],providers:[],provider:{id:null,referenceUrl:null,name:null},label:{},labels:[],loading:!1,configgering:!1,error:null,isPreview:!1,icon:{anchor:{horizontal:{},vertical:{}}}},store:{},rte:{},setDatatype:function(n){$scope.vm().showMap=!1;$scope.vm().provider.events&&$scope.vm().provider.events.destroy();i(function(){for(var r,i=$scope.terratype.gridOverlay.dataTypes,t=0;t!=i.length;t++)if(i[t].id==n){r=angular.copy(i[t].config);$scope.terratype.gridOverlay.store.datatypeId=n;$scope.terratype.gridOverlay.vm.config=r.config;$scope.terratype.loadEditor($scope.terratype.gridOverlay.identifier,r);break}},$scope.terratype.poll)},parentScope:function(){return $scope.parentScope()}},labelOverlay:{init:function(){r.localize($scope.terratype.labelOverlay.title).then(function(n){$scope.terratype.labelOverlay.title=n});r.localize($scope.terratype.labelOverlay.subtitle).then(function(n){$scope.terratype.labelOverlay.subtitle=n})},title:"terratypeLabelOverlay_title",subtitle:"terratypeLabelOverlay_subtitle",show:!1,display:function(){return $scope.terratype.labelOverlay.show==!0?!1:($scope.terratype.labelOverlay.show=!0,!1)},submit:function(n){$scope.terratype.setLabel();n.show=!1},view:"uninitalized",vm:$scope.vm,config:function(){return $scope.config().label},store:function(){return $scope.store().label}},loadGrid:function(){try{$scope.vm=function(){return $scope.viewmodel};$scope.config=function(){return $scope.viewmodel.config};$scope.store=function(){return $scope.control.value};$http.get($scope.terratype.controller("maps?id="+$scope.control.value.datatypeId)).then(function(n){if(n.data.length==1){var t=angular.copy(n.data[0].config);$scope.viewmodel.config=t.config;$scope.terratype.loadEditor($scope.identifier,t,function(){with({display:$scope.terratype.gridOverlay.display})$scope.vm().provider.events.addEvent("map-click",function(){display()},$scope),$scope.vm().provider.events.addEvent("icon-click",function(){display()},$scope)})}})}catch(n){console.log(n);$scope.vm().loading=!1;$scope.vm().error=!0;$scope.config().debug=1}},initGrid:function(){$scope.terratype.gridOverlay.view=$scope.terratype.urlProvider(t,"views/grid.overlay.html",!0);r.localize($scope.terratype.gridOverlay.title).then(function(n){$scope.terratype.gridOverlay.title=n});r.localize($scope.terratype.gridOverlay.subtitle).then(function(n){$scope.terratype.gridOverlay.subtitle=n});$scope.terratype.labelOverlay.init();i(function(){if($scope.vm=function(){return $scope.viewmodel},$scope.vm().loading=!1,!$scope.control.$initializing&&$scope.control.value)try{typeof $scope.control.value=="string"&&($scope.control.value=$scope.control.value!=""?JSON.parse($scope.control.value):null);$scope.terratype.loadGrid()}catch(n){console.log(n);$scope.vm().error=!0;$scope.control.value={}}},$scope.terratype.poll)},providerTest:function(){$scope.vm().providerTestResults=["Loading..."];$http.get($scope.terratype.controller("TestProviders")).then(function(n){n.data.length!=0&&($scope.vm().providerTestResults=n.data)})}};$scope.parentScope=function(){return $scope}}]);angular.module("umbraco").controller("terratype.label.standard",["$scope","$timeout","localizationService","$controller","tinyMceService","macroService",function(t,i,r,u,f,e){t.identifier=t.$id+(new Date).getTime();t.colors=[{id:"#ffffff"},{id:"#faebd7"},{id:"#f5f5dc"},{id:"#ffe4c4"},{id:"#c0c0c0"},{id:"#808080"},{id:"#000000"},{id:"#ff0000"},{id:"#800000"},{id:"#ffff00"},{id:"#808000"},{id:"#00ff00"},{id:"#008000"},{id:"#00ffff"},{id:"#008080"},{id:"#0000ff"},{id:"#000080"},{id:"#ff00ff"},{id:"#800080"}];t.init=function(){for(var i=t.$parent,r;i;){if(i.terratype)break;i=i.$parent}t.vm=i.vm;t.config=i.config;t.store=i.store;t.terratype=i.terratype;t.setForeground=function(n){t.store().label.foreground=n};t.setBackground=function(n){t.store().label.background=n};t.rte={id:t.identifier+"rte",getEditor:function(){for(var n=0;n!=tinymce.editors.length;n++)if(tinymce.editors[n].id==t.rte.id)return tinymce.editors[n];return null},createLabel:function(i){var f=i.getElement().getAttribute("placeholder")||i.settings.placeholder,e=i.settings.placeholder_attrs||{style:{position:"absolute",width:"100%",overflow:"hidden",display:"none"}},r=n.tinymce.DOM.create("div",e),o,u;return r.addEventListener?r.addEventListener("click",t.rte.focusEvent,!1):r.attachEvent&&r.attachEvent("onclick",t.rte.focusEvent),o=n.tinymce.DOM.add(r,"span",{style:{padding:"10px",color:"#aaaaaa","font-size":"17px !important;","white-space":"pre-wrap",display:"inline-block"}},f),u=i.getContentAreaContainer(),u.insertBefore(r,u.firstChild),r},label:null,focusEvent:function(){t.rte.focus();n.tinymce.execCommand("mceFocus",!1)},focus:function(){var n=t.rte.getEditor();!n.settings.readonly==!0&&(t.rte.label.style.display="none")},blur:function(){var n=t.rte.getEditor();t.rte.label.style.display=n.getContent()==""?"":"none";t.terratype.setLabel()},config:{selector:"textarea",toolbar:["code","styleselect","bold","italic","forecolor","backcolor","alignleft","aligncenter","alignright","bullist","numlist","link","umbmediapicker","umbembeddialog"],stylesheets:[]},linkPickerOverlay:{},openLinkPicker:function(n,i,r){t.rte.linkPickerOverlay={view:"linkpicker",currentTarget:i,show:!0,submit:function(i){f.insertLinkInEditor(n,i.target,r);t.rte.linkPickerOverlay.show=!1;t.rte.linkPickerOverlay=null}}},mediaPickerOverlay:{},openMediaPicker:function(n,i,r){t.rte.mediaPickerOverlay={currentTarget:i,onlyImages:!0,showDetails:!0,startNodeId:r.startMediaId,view:"mediapicker",show:!0,submit:function(i){f.insertMediaInEditor(n,i.selectedImages[0]);t.rte.mediaPickerOverlay.show=!1;t.rte.mediaPickerOverlay=null},onImageLoaded:function(){}}},embedOverlay:{},openEmbed:function(n){t.rte.embedOverlay={view:"embed",show:!0,submit:function(i){f.insertEmbeddedMediaInEditor(n,i.embed.preview);t.rte.embedOverlay.show=!1;t.rte.embedOverlay=null}}},macroPickerOverlay:{},openMacroPicker:function(n,i){t.rte.macroPickerOverlay={view:"macropicker",dialogData:i,show:!0,submit:function(r){var u=e.collectValueData(r.selectedMacro,r.macroParams,i.renderingEngine);f.insertMacroInEditor(n,u,t);t.rte.macroPickerOverlay.show=!1;t.rte.macroPickerOverlay=null}}}};r=setInterval(function(){if(n.tinymce){var i=t.rte.getEditor();i!=null&&i.getContentAreaContainer()!=null&&(clearInterval(r),t.rte.label=new t.rte.createLabel(i),t.rte.blur())}},100)}}]);angular.module("umbraco").controller("terratype.grid.overlay",["$scope",function(n){n.gridOverlay=n.$parent.model;n.gridOverlay.identifier||(n.gridOverlay.identifier=n.$id+(new Date).getTime());n.identifier=n.gridOverlay.identifier;n.vm=function(){return n.gridOverlay.vm};n.config=function(){return n.gridOverlay.vm.config};n.store=function(){return n.gridOverlay.store};n.parentScope=n.gridOverlay.parentScope;n.init=function(){}}])})(window);