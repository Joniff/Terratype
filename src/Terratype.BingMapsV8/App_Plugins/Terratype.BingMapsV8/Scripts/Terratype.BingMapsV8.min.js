(function(n){var r="GCJ02",t={id:"Terratype.BingMapsV8",originalConsole:n.console,domain:null,version:null,apiKey:null,coordinateSystem:null,forceHttps:!1,language:null,subsystemUninitiated:0,subsystemInit:1,subsystemReadBingJs:2,subsystemCheckBingJs:3,subsystemLoadedBingJs:4,subsystemCooloff:5,subsystemCompleted:6,status:0,killswitch:!1,poll:100,timeout:15e3,fakeConsole:{isFake:!0,error:function(i){if((i.indexOf("Bing Maps API")!=-1||i.indexOf("Bing Maps Javascript API")!=-1)&&(i.indexOf("MissingKeyMapError")!=-1||i.indexOf("ApiNotActivatedMapError")!=-1||i.indexOf("InvalidKeyMapError")!=-1||i.indexOf("not authorized")!=-1||i.indexOf("RefererNotAllowedMapError")!=-1)){n.terratype.event.broadcast(t.id+".error");t.destroySubsystem();return}try{t.originalConsole.warn(i)}catch(r){}},warn:function(n){try{t.originalConsole.warn(n)}catch(i){}},log:function(n){try{t.originalConsole.log(n)}catch(i){}}},installFakeConsole:function(){typeof n.console.isFake=="undefined"&&(n.console=t.fakeConsole)},uninstallFakeConsole:function(){n.console=t.originalConsole},isBingMapsLoaded:function(){return angular.isDefined(n.Microsoft)&&angular.isDefined(n.Microsoft.Maps)},uninstallScript:function(n){for(var t,r=document.getElementsByTagName("script"),i=r.length;i>=0;i--)t=r[i],t&&t.getAttribute("src")!=null&&t.getAttribute("src").indexOf(n)!=-1&&t.parentNode.removeChild(t)},destroySubsystem:function(){t.searchesTimer!=null&&(clearInterval(t.searchesTimer),t.searchesTimer=null);t.uninstallFakeConsole();delete n.Microsoft.Maps;delete n.$MicrosoftMaps8;n.Microsoft={Maps:{NetworkCallbacks:{normal:function(){return!1}},GlobalConfig:{}}};t.domain&&(t.uninstallScript(t.domain),t.domain=null);t.status=t.subsystemUninitiated;t.killswitch=!0;t.version=null;t.apiKey=null;t.coordinateSystem=null;t.forceHttps=!1;t.language=null},ticks:function(){return(new Date).getTime()},createSubsystem:function(i,u,f,e,o){n.terratypeBingMapsV8Callback=function(){(t.status==t.subsystemInit||t.status==t.subsystemReadBingJs)&&(t.status=t.subsystemCheckBingJs)};var s=t.ticks()+t.timeout,h=0,c=setInterval(function(){var l,a,u;t.ticks()>s?(clearInterval(c),n.terratype.event.broadcast(t.id+".killed"),t.destroySubsystem()):t.status==t.subsystemCompleted||t.status==t.subsystemUninitiated||t.status==t.subsystemInit?(clearInterval(c),i||(i="3"),t.version=i,t.forceHttps=f,l="",f&&(l="https:"),t.coordinateSystem=e,t.domain=l+(e==r?"//www.bing.com/":"//www.bing.com/"),t.status=t.subsystemInit,t.killswitch=!1,t.language=o,a="",o&&(a="&mkt="+o),s=t.ticks()+t.timeout,u=setInterval(function(){if(t.killswitch)clearInterval(u);else switch(t.status){case t.subsystemInit:LazyLoad.js(t.domain+"api/maps/mapcontrol?branch="+i+"&callback=terratypeBingMapsV8Callback"+a,function(){});s=t.ticks()+t.timeout;t.status=t.subsystemReadBingJs;break;case t.subsystemReadBingJs:t.ticks()>s&&(clearInterval(u),n.terratype.event.broadcast(t.id+".error"),t.destroySubsystem());break;case t.subsystemCheckBingJs:t.isBingMapsLoaded()?(t.installFakeConsole(),t.status=t.subsystemLoadedBingJs,n.terratype.event.broadcast(t.id+".refresh")):t.ticks()>s&&(clearInterval(u),n.terratype.event.broadcast(t.id+".error"),t.destroySubsystem());break;case t.subsystemLoadedBingJs:t.status=t.subsystemCooloff;s=t.ticks()+t.timeout;break;case t.subsystemCooloff:case t.subsystemCompleted:h=n.terratype.event.broadcastSingle(t.id+".refresh",h);h==null?(clearInterval(u),t.destroySubsystem()):t.status==t.subsystemCooloff&&t.ticks()>s&&(t.status=t.subsystemCompleted,t.uninstallFakeConsole())}},t.poll)):t.killswitch=!0},t.poll)},configIconUrl:function(t){return typeof t=="undefined"||t==null?"":t.indexOf("//")!=-1?t:(t.substring(0,1)!="/"&&(t="/"+t),n.location.protocol+"//"+n.location.hostname+(n.location.port?":"+n.location.port:"")+t)},getAnchorHorizontal:function(n,t){if(typeof n=="string")switch(n.charAt(0)){case"l":case"L":return 0;case"c":case"C":case"m":case"M":return t/2;case"r":case"R":return t-1}return Number(n)},getAnchorVertical:function(n,t){if(typeof n=="string")switch(n.charAt(0)){case"t":case"T":return 0;case"c":case"C":case"m":case"M":return t/2;case"b":case"B":return t-1}return Number(n)},mapTypeIds:function(t,i,r,u){var f=[];return t&&(u!=""?f.push(n.Microsoft.Maps.MapTypeId[u]):f.push(n.Microsoft.Maps.MapTypeId.road)),i&&f.push(n.Microsoft.Maps.MapTypeId.aerial),r&&f.push(n.Microsoft.Maps.MapTypeId.streetside),f.length==0&&f.push(n.Microsoft.Maps.MapTypeId.road),f},round:function(n,t){var r=n>=0?1:-1,i=Math.pow(10,t);return parseFloat((Math.round(n*i+r*.001)/i).toFixed(t))},mergeJson:function(n,t){var i=function(n){var r={};for(var t in n)r[t]=typeof n[t]=="object"&&n[t].constructor.name!=="Array"?i(n[t]):n[t];return r},r=function(n,t){var f=n?i(n):{},u;if(t)for(u in t)f[u]=f[u]&&typeof f[u]=="object"&&f[u].constructor.name!=="Array"?r(f[u],t[u]):t[u];return f};return r(n,t)}},i={datumWait:330,css:[],js:[],boot:function(r,u,f,e,o,s,h,c){var l={events:[],datumChangeWait:null,defaultConfig:{position:{datum:"55.4063207,10.3870147"},zoom:12,provider:{id:t.id,version:"release",forceHttps:!0,language:"",predefineStyling:"road",showLabels:!0,variety:{basic:!0,satellite:!1,streetView:!1},scale:{enable:!0},breadcrumb:{enable:!0},dashboard:{enable:!0},traffic:{enable:!1,legend:!1}},search:{enable:0}},initValues:function(){f().position.datum||(f().position.datum=l.defaultConfig.position.datum);o().position.datum=l.parse.call(l,f().position.datum);f().zoom||(f().zoom=l.defaultConfig.zoom);e().provider=t.mergeJson(l.defaultConfig.provider,e().provider);e().search=t.mergeJson(l.defaultConfig.search,e().search)},init:function(){f().position&&typeof f().position.datum=="string"&&(o().position.datum=l.parse.call(l,f().position.datum));o().isPreview==!1&&e().provider&&e().provider.version&&f().position&&f().position.id&&o().position.precision&&l.loadMap.call(l);c({httpCalls:{apiKey:{when:"config.provider.id="+t.id,field:"config.provider.apiKey",values:[]}},files:{logo:u(t.id,"images/Logo.png"),mapExample:u(t.id,"images/Example.png"),views:{config:{definition:u(t.id,"views/config.definition.html",!0),appearance:u(t.id,"views/config.appearance.html",!0),search:u(t.id,"views/config.search.html",!0)},editor:{appearance:u(t.id,"views/editor.appearance.html",!0)},grid:{appearance:u(t.id,"views/grid.appearance.html",!0)}}},setProvider:function(){o().provider.id!=t.id&&l.destroy()},setCoordinateSystem:function(){f().position&&f().position.id!=t.coordinateSystem&&l.reloadMap.call(l)},setIcon:function(){l.gmarker&&l.gmarker.setOptions({icon:e().icon.url,anchor:new n.Microsoft.Maps.Point(t.getAnchorHorizontal(e().icon.anchor.horizontal,e().icon.size.width),t.getAnchorVertical(e().icon.anchor.vertical,e().icon.size.height))})},forceHttpsChange:function(){e().provider.forceHttps!=t.forceHttps&&l.reloadMap.call(l)},languageChange:function(){e().provider.language!=t.language&&l.reloadMap.call(l)},versionChange:function(){e().provider.version!=t.version&&l.reloadMap.call(l)},styleChange:function(){if(l.gmap){var n=t.mapTypeIds.call(t,e().provider.variety.basic,e().provider.variety.satellite,e().provider.variety.streetView,e().provider.predefineStyling);l.gmap.setView({mapTypeId:n[0]})}},datumChange:function(n){o().datumChangeText=n;l.datumChangeWait&&clearTimeout(l.datumChangeWait);l.datumChangeWait=setTimeout(function(){l.datumChangeWait=null;var n=l.parse.call(l,o().datumChangeText);if(typeof n!="boolean"){o().position.datum=n;l.setDatum.call(l);l.setMarker.call(l);return}o().position.datumStyle={color:"red"}},i.datumWait)},optionChange:function(){l.gmap&&l.reloadMap.call(l)},searchChange:function(){typeof e().search.enable=="string"&&(e().search.enable=parseInt(e().search.enable));l.deleteSearch.call(l);e().search.enable!=0&&setTimeout(function(){l.createSearch.call(l)},1)},reload:function(){l.reloadMap.call(l)},addEvent:function(n,t,i){l.events.push({id:n,func:t,scope:i})},labelChange:function(){l.gmap&&(l.ginfo&&(delete l.ginfo,l.ginfo=null),f().label&&typeof f().label.content=="string"&&f().label.content.trim()!=""&&(l.ginfo=new n.Microsoft.Maps.Infobox(l.gmarker.getLocation(),{description:" ",visible:!1,pushpin:l.gmarker}),l.ginfo._options.description=f().label.content,l.ginfo.setMap(l.gmap)))},destroy:l.destroy})},destroy:function(){n.terratype.event.cancel(r);l.loadMapWait&&(clearTimeout(l.loadMapWait),l.loadMapWait=null);l.superWaiter&&(clearInterval(l.superWaiter),l.superWaiter=null);n.Microsoft&&n.Microsoft.Maps&&n.Microsoft.Maps.Events&&angular.forEach(l.gevents,function(t){n.Microsoft.Maps.Events.removeHandler(t)});l.gmap&&l.gmap.dispose();l.coordEnter&&(l.removeDomEvent(l.coordEnter),l.coordEnter=null);delete l.gevents;delete l.gmap;delete l.gmarker;delete l.traffic;l.deleteSearch.call(l)},reloadMap:function(){if(l.destroy(),l.div)var t=document.getElementById(l.div),n=100,i=setInterval(function(){--n<0&&(clearInterval(i),l.loadMap.call(l));try{var r=t.firstChild;r?t.removeChild(r):n=0}catch(u){n=0}},1);else l.loadMap.call(l)},parse:function(n){var r,t,i;return typeof n!="string"?!1:(r=n.trim().split(","),r.length<2)?!1:(t=parseFloat(r[0].substring(0,10)),isNaN(t)||t>90||t<-90)?!1:(i=parseFloat(r[1].substring(0,10)),isNaN(i)||i>180||i<-180)?!1:{latitude:t,longitude:i}},isElementInViewport:function(n){var t=n.getBoundingClientRect();return t.top<=(window.innerHeight||document.documentElement.clientHeight)&&t.top+t.height>=0&&t.left<=(window.innerWidth||document.documentElement.clientWidth)&&t.left+t.width>=0},toString:function(n,t){function i(n){return Number(n).toFixed(t).replace(/\.?0+$/,"")}return i(n.latitude)+","+i(n.longitude)},setDatum:function(){var n=l.toString.call(l,o().position.datum,o().position.precision);typeof n!="boolean"?(f().position.datum=n,o().position.datumText=n,o().position.datumStyle={}):o().position.datumStyle={color:"red"}},setMarker:function(){if(l.gmap&&l.gmarker){var t=new n.Microsoft.Maps.Location(o().position.datum.latitude,o().position.datum.longitude);l.gmarker.setLocation(t);l.gmap.setView({center:t})}},loadMapWait:null,div:null,divoldsize:0,visible:!1,divwait:0,superWaiter:null,coordEnter:null,loadMap:function(){l.loadMapWait==null&&(l.loadMapWait=setTimeout(function(){l.initValues();l.loadMapWait=null;o().status={loading:!0,reload:!0};o().showMap=!1;l.gmap=null;l.gmarker=null;l.gautocomplete=null;l.traffic=null;l.gevents=[];l.div=null;l.divoldsize=0;l.divwait=t.timeout/t.poll;n.terratype.event.register(r,t.id+".error",l,this,function(){o().status={failed:!0,reload:!0};n.terratype.event.cancel(r);clearInterval(l.superWaiter);l.superWaiter=null;s()});n.terratype.event.register(r,t.id+".killed",l,this,function(){o().status={reload:!0};n.terratype.event.cancel(r);clearInterval(l.superWaiter);l.superWaiter=null;s()});n.terratype.event.register(r,t.id+".refresh",l,this,function(){var i,u,h;if(n.Microsoft)if(l.div==null){if(o().status={success:!0,reload:!0},o().provider.version=t.version,o().provider.versionMajor=8,typeof e().search.enable=="string"&&(e().search.enable=parseInt(e().search.enable)),t.forceHttps!=e().provider.forceHttps||t.language!=e().provider.language){o().status={duplicate:!0,reload:!0};n.terratype.event.cancel(r);s();return}l.ignoreEvents=0;l.div="terratype_"+r+"_bingmapsv8_map";o().showMap=!0;s()}else if(i=document.getElementById(l.div),i==null)l.gmap==null&&l.divwait!=0?l.divwait--:l.destroy.call(l);else if(l.gmap==null)l.gevents=[],u=new n.Microsoft.Maps.Location(o().position.datum.latitude,o().position.datum.longitude),h=t.mapTypeIds.call(t,e().provider.variety.basic,e().provider.variety.satellite,e().provider.variety.streetView,e().provider.predefineStyling),l.gmap=new n.Microsoft.Maps.Map(i,{credentials:e().provider.apiKey,enableSearchLogo:!1,showBreadcrumb:e().provider.breadcrumb.enable,showCopyright:!1,showDashboard:e().provider.dashboard.enable,showMapTypeSelector:h.length>1,showScalebar:e().provider.scale.enable,disableBirdseye:!e().provider.variety.satellite,disableScrollWheelZoom:!0,labelOverlay:e().provider.showLabels?n.Microsoft.Maps.LabelOverlay.visible:n.Microsoft.Maps.LabelOverlay.hidden,allowHidingLabelsOfRoad:!e().provider.showLabels,showMapLabels:e().provider.showLabels,mapTypeId:h[0],fixedMapPosition:!0}),l.gmap.setView({center:u,zoom:f().zoom,mapTypeId:h[0],labelOverlay:e().provider.showLabels?n.Microsoft.Maps.LabelOverlay.visible:n.Microsoft.Maps.LabelOverlay.hidden}),l.gevents.push(n.Microsoft.Maps.Events.addHandler(l.gmap,"viewchangeend",function(){l.gmap.getZoom()!=f().zoom&&l.eventZoom.call(l)})),l.gmarker=new n.Microsoft.Maps.Pushpin(u,{id:"terratype_"+r+"_marker",draggable:!0,icon:e().icon.url,anchor:new n.Microsoft.Maps.Point(t.getAnchorHorizontal(e().icon.anchor.horizontal,e().icon.size.width),t.getAnchorVertical(e().icon.anchor.vertical,e().icon.size.height))}),l.gmap.entities.push(l.gmarker),l.ginfo=null,f().label&&typeof f().label.content=="string"&&f().label.content.trim()!=""&&(l.ginfo=new n.Microsoft.Maps.Infobox(u,{description:" ",visible:!1,pushpin:l.gmarker}),l.ginfo._options.description=f().label.content,l.ginfo.setMap(l.gmap)),l.gevents.push(n.Microsoft.Maps.Events.addHandler(l.gmarker,"click",function(){l.ignoreEvents>0||l.callEvent("icon-click")&&l.ginfo&&l.ginfo.setOptions({visible:!l.ginfo.getVisible()})})),l.gevents.push(n.Microsoft.Maps.Events.addHandler(l.gmap,"click",function(){l.ignoreEvents>0||(l.ginfo&&l.ginfo.getVisible()&&l.ginfo.setOptions({visible:!1}),l.callEvent("map-click"))})),l.gevents.push(n.Microsoft.Maps.Events.addHandler(l.gmarker,"dragend",function(){l.eventDrag.call(l)})),e().search.enable!=0&&l.createSearch.call(l),e().provider.traffic.enable==!0&&n.Microsoft.Maps.loadModule("Microsoft.Maps.Traffic",function(){l.traffic=new n.Microsoft.Maps.Traffic.TrafficManager(l.gmap);l.traffic.show();e().provider.traffic.legend?l.traffic.showLegend():l.traffic.hideLegend()}),l.setDatum.call(l),s();else{var y=i.parentElement.offsetTop+i.parentElement.offsetWidth,c=i.clientHeight*i.clientWidth,a=o().showMap,v=a&&l.isElementInViewport(i);y!=0&&a==!1?(o().showMap=!0,s(),setTimeout(function(){document.getElementById(l.div).hasChildNodes()==!1?l.reloadMap.call(l):l.eventRefresh.call(l)},1)):y==0&&a==!0?(o().showMap=!1,l.visible=!1):v==!0&&l.divoldsize!=0&&c!=0&&l.divoldsize!=c?(l.eventRefresh.call(l),l.visible=!0):v==!0&&l.visible==!1?(l.eventRefresh.call(l),l.visible=!0):v==!1&&l.visible==!0&&(l.visible=!1);l.divoldsize=c}else l.reloadMap.call(l)});t.status==t.subsystemUninitiated&&t.createSubsystem(e().provider.version,e().provider.apiKey,e().provider.forceHttps,f().position.id,e().provider.language);count=0;l.superWaiter=setInterval(function(){function n(){count>5&&(o().status={error:!0,reload:!0},clearInterval(l.superWaiter),l.superWaiter=null,s());t.createSubsystem(e().provider.version,e().provider.apiKey,e().provider.forceHttps,f().position.id,e().provider.language);count++}t.status!=t.subsystemCooloff&&t.status!=t.subsystemCompleted?n():l.div==null||l.gmap==null||document.getElementById(l.div)==null||document.getElementById(l.div).hasChildNodes()==!1?(t.destroySubsystem(),setTimeout(n,1)):(o().status={success:!0},clearInterval(l.superWaiter),l.superWaiter=null,s())},t.timeout)},t.poll))},eventZoom:function(){l.ignoreEvents>0||(f().zoom=l.gmap.getZoom())},eventRefresh:function(){var n;if(l.gmap!=null&&!(l.ignoreEvents>0)){l.ignoreEvents++;l.gmap.setView({zoom:f().zoom});l.setMarker.call(l,!0);var i=l.gmap.getMapTypeId(),r=t.mapTypeIds.call(t,e().provider.variety.basic,e().provider.variety.satellite,e().provider.variety.streetView,e().provider.predefineStyling),u=!1;for(n=0;n!=r.length;n++)if(r[n]==i){u=!0;break}u==!1&&(i=r[n]);l.gmap.setMapType(Microsoft.Maps.MapTypeId.mercator);setTimeout(function(){l.gmap.setMapType(i);l.ignoreEvents--},1)}},eventCheckRefresh:function(){l.gmap.getBounds()&&!l.gmap.getBounds().contains(l.gmarker.getLocation())&&l.eventRefresh.call(l)},eventDrag:function(){l.ignoreEvents>0||(l.ignoreEvents++,o().position.datum={latitude:t.round(l.gmarker.getLocation().latitude,o().position.precision),longitude:t.round(l.gmarker.getLocation().longitude,o().position.precision)},l.setMarker.call(l),l.setDatum.call(l),s(),l.ignoreEvents--)},eventLookup:function(n,i){l.ignoreEvents>0||(l.ignoreEvents++,f().lookup=i,o().position.datum={latitude:t.round(n.latitude,o().position.precision),longitude:t.round(n.longitude,o().position.precision)},l.setMarker.call(l),l.setDatum.call(l),s(),l.ignoreEvents--)},searchLookupElement:function(n){return typeof n=="undefined"&&(n=e().search.enable),document.getElementById("terratype_"+r+"_bingmapsv8_lookup_"+(n==2?"autosuggest":"normal"))},searchResultElement:function(){return document.getElementById("terratype_"+r+"_bingmapsv8_lookup_results")},lastSearch:null,doSearch:function(n){var t=l.searchLookupElement();if(n.which==13)return l.lastSearch!=t.value&&(l.lastSearch=t.value,l.searchManager.geocode&&l.searchManager.geocode({callback:function(n){n&&n.results&&n.results.length>0?(l.eventLookup.call(l,n.results[0].location,n.results[0].name),$(t).css("color","")):$(t).css("color","#ff0000");e().search.enable==2&&$(l.searchResultElement()).find(".MicrosoftMap .as_container_search").css("visibility","hidden")},count:1,where:t.value,timeout:5,errorCallback:function(){$(t).css("color","#ff0000")}})),n.preventDefault();$(t).css("color","")},searchManager:null,autoSuggestManager:null,createSearch:function(){function t(){l.searchManager=new n.Microsoft.Maps.Search.SearchManager(l.gmap);$(l.searchLookupElement()).on("keypress keydown",l.doSearch)}function i(){l.autoSuggestManager=new n.Microsoft.Maps.AutosuggestManager({maxResults:5,map:l.gmap,addressSuggestions:!0,autoDetectLocation:!1,placeSuggestions:!0,useMapView:!1,userLocation:!1});l.autoSuggestManager.attachAutosuggest(l.searchLookupElement(),l.searchResultElement(),function(n){n&&n.location&&l.eventLookup.call(l,n.location,n.formattedSuggestion)})}e().search.enable!=0&&l.searchLookupElement()!=null&&(n.Microsoft.Maps.Search?t():n.Microsoft.Maps.loadModule("Microsoft.Maps.Search",{callback:function(){t()}}),e().search.enable==2&&(n.Microsoft.Maps.AutosuggestManager?i():n.Microsoft.Maps.loadModule("Microsoft.Maps.AutoSuggest",function(){i()})))},deleteSearch:function(){l.autoSuggestManager&&(l.autoSuggestManager.detachAutosuggest(),l.autoSuggestManager.dispose(),l.autoSuggestManager=null);l.searchManager;$(l.searchLookupElement(!1)).off("keypress keydown");$(l.searchLookupElement(!0)).off("keypress keydown")},callEvent:function(n){for(var t=0;t!=l.events.length;t++)l.events[t].id==n&&l.events[t].func.call(l.events[t].scope)}};return l.init(c)}};n.terratype.providers[t.id]=i})(window);